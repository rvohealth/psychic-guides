"use strict";(self.webpackChunkpsychic_guides=self.webpackChunkpsychic_guides||[]).push([[2416],{3118:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>i});var t=n(4848),r=n(8453);n(6592);const o={sidebar_position:2},a="request",l={id:"controllers/request",title:"request",description:"request and response objects",source:"@site/docs/controllers/request.mdx",sourceDirName:"controllers",slug:"/controllers/request",permalink:"/docs/controllers/request",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/controllers/request.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"guides",previous:{title:"generating",permalink:"/docs/controllers/generating"},next:{title:"response",permalink:"/docs/controllers/response"}},c={},i=[{value:"request and response objects",id:"request-and-response-objects",level:2},{value:"params",id:"params",level:2}];function d(e){const s={code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"request",children:"request"}),"\n",(0,t.jsx)(s.h2,{id:"request-and-response-objects",children:"request and response objects"}),"\n",(0,t.jsx)(s.p,{children:"Any controller extending the PsychicController class will automatically contain references to the request and response objects, since they are coupled to the controller upon instantiation of the class."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import { PsychicController, Params } from 'psychic'\n\nexport default class HowyadoinsController extends PsychicController {\n  public async create() {\n    console.log(this.req)\n    // returns an express request object\n\n    console.log(this.req)\n    // returns an express response object\n  }\n}\n"})}),"\n",(0,t.jsxs)(s.p,{children:["the req and res properties on your controller point directly to express request and response objects. Considering, if you are quite familiar with express, you will easily be able to leverage the ",(0,t.jsx)(s.code,{children:"req"})," and ",(0,t.jsx)(s.code,{children:"res"})," properties to do things you would normally do in express, like:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"import { PsychicController, Params } from 'psychic'\n\nexport default class HowyadoinsController extends PsychicController {\n  public async create() {\n    this.res.json({ how: 'yadoin' })\n  }\n}\n"})}),"\n",(0,t.jsx)(s.h2,{id:"params",children:"params"}),"\n",(0,t.jsxs)(s.p,{children:["If you want to, you can always access all the params of your request by using ",(0,t.jsx)(s.code,{children:"this.params"})," (like so:)"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"export default class HowyadoinsController extends PsychicController {\n  public async create() {\n    console.log(this.params)\n  }\n}\n"})}),"\n",(0,t.jsxs)(s.p,{children:["The only problem with this approach, is it casts the return value as ",(0,t.jsx)(s.code,{children:"any"}),". If you would like to do any type casting and validation, you can use the ",(0,t.jsx)(s.code,{children:"castParam"})," method, like so:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"export default class HowyadoinsController extends PsychicController {\n  public async create() {\n    const id = this.castParam('id', 'bigint')\n    const rating = this.castParam('rating', 'number')\n    const role = this.castParam('rating', 'string', {\n      enum: ['Admin', 'Basic'],\n    })\n  }\n}\n"})}),"\n",(0,t.jsx)(s.p,{children:"Psychic also provides paramsFor, which automatically types params used to create or update a Dream model. paramsFor automatically filters out the following columns so that these always remain under the explicit control of the application:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"the primary key (default id)"}),"\n",(0,t.jsx)(s.li,{children:"the created at field (default createdAt)"}),"\n",(0,t.jsx)(s.li,{children:"the updated at field (default updatedAt)"}),"\n",(0,t.jsx)(s.li,{children:"the deleted at field (default deletedAt)"}),"\n",(0,t.jsx)(s.li,{children:"BelongsTo association columns (foreign key and polymorphic type column)"}),"\n",(0,t.jsx)(s.li,{children:"STI type column"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["paramsFor also supports ",(0,t.jsx)(s.code,{children:"only: [<array of column names>]"})," to limit the columns that the client can modify."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:"export default class HowyadoinsController extends PsychicController {\n  public async create() {\n    const userParams = this.paramsFor(User) // these will be typed and validated\n    await this.currentUser.update(userParams)\n  }\n}\n"})})]})}function u(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},6592:(e,s,n)=>{n.d(s,{A:()=>r});var t=n(4848);function r(e){let{children:s}=e;return(0,t.jsx)("div",{className:"right-sidebar-item",children:s})}},8453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>l});var t=n(6540);const r={},o=t.createContext(r);function a(e){const s=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(o.Provider,{value:s},e.children)}}}]);