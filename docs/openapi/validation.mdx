---
sidebar_position: 4
title: validation
ai_summary: OpenAPI validation validates requests (headers, requestBody, query) and responses (responseBody). Can be configured globally in conf/app.ts or per-endpoint in @OpenAPI decorator. Returns 400 for invalid requests. Supports detailedErrors option for development/test environments.
---

# OpenAPI - Validation

In addition to automatically generating OpenAPI specs for your application, Psychic also provides built-in request and response validation, leveraging the OpenAPI specs to determine the appropriate shapes for your request body, query, headers, and response bodies.

## Opting into validations

To opt into this, you can take one of two configuration actions:

### 1. Global validation config

Defining a global validation config will apply to all endpoints belonging to OpenAPI-decorated controllers. To tap into the global config, open the `conf/app.ts` file and update your `openapi` configuration to include validation, like so:

```ts
// conf/app.ts
export default async (psy: PsychicApp) => {
  ...

  psy.set('openapi', {
    // ...
    validate: {
      headers: true,
      requestBody: true,
      query: true,
      responseBody: AppEnv.isTest,
      detailedErrors: AppEnv.isDevelopmentOrTest,
    },
  })
}
```

If you have multiple OpenAPI configurations, you will need to apply validation to each one of them if you want to make sure it spreads to all the controllers leveraging it. In some cases, this is not necessary. For example, you may have one OpenAPI spec for mobile, and one for web, but they may both cover the same endpoints. If this is the case, you don't need validation on both.

However, if you decided to have one OpenAPI spec for your admin endpoints and one for your app endpoints, then you would probably want to apply validation rules to both. To understand more about how Psychic leverages multiple OpenAPI specs, see our [multiple specs guides](/docs/openapi/multiple-specs).

### 2. Per-endpoint validation

Within the OpenAPI decorator, you can also provide the same validation options. If they are provided, Psychic will merge the options with the global defaults provided, prioritizing the custom validation options over the global defaults:

```ts
// controllers/PetsController
export default class PetsController {
  @OpenAPI(Pet, {
    ...
    validate: {
      // always validate headers/requestBody/query/responseBody
      // for this endpoint even when disabled
      // at the application level
      headers: true,
      requestBody: true,
      query: true,
      responseBody: true,

      // always include detailed OpenAPI validation errors
      // for this endpoint even when detailed errors are
      // disabled at the application level
      detailedErrors: true,
    }
  })
  public async index() {
    ...
  }
}
```

## Overriding Ajv validation defaults

Psychic leverages [ajv](https://ajv.js.org) to validate openapi schemas. If you would like to customize the Ajv validator, you can provide custom overrides via `ajvOptions`, which will be sent through to the constructor of the imported `Ajv` class.

```ts
// controllers/PetsController
export default class PetsController {
  @OpenAPI(Pet, {
    ...
    validate: {
      ajvOptions: {
        // this is off by default, but you will
        // always want to keep this off in prod
        // to avoid DoS vulnerabilities
        allErrors: AppEnv.isTest,

        // provide a custom init function to further
        // configure your ajv instance before validating
        init: ajv => {
          ajv.addFormat('myFormat', {
            type: 'string',
            validate: data => MY_FORMAT_REGEX.test(data),
          })
        }
      }
    }
  })
  public async index() {
    ...
  }
}
```

:::warning
Psychic clones data before sending it into ajv, so attempting to use options which would mutate the incoming data will not take effect the way you would expect.
:::
